<app-modal [isOpen]="isOpen()" [title]="'Match Details'" (close)="onClose()">
  @if (loading()) {
  <div class="flex justify-center items-center py-8">
    <lucide-angular
      [img]="icons.Loader2"
      size="24"
      class="animate-spin text-primary"
    ></lucide-angular>
    <span class="ml-2">Loading match details...</span>
  </div>
  } @else if (match()) {
  <div class="space-y-2">
    <div class="text-center card">
      <div class="flex items-center justify-center space-x-4 mb-4">
        <div class="flex items-center space-x-2">
          @if (match()!.homeTeamLogo) {
          <img
            [src]="match()!.homeTeamLogo"
            [alt]="match()!.homeTeamName"
            class="w-8 h-8 rounded-full object-cover"
          />
          }
          <span class="font-semibold">{{ match()!.homeTeamName }}</span>
        </div>

        <div class="flex items-center space-x-2 px-4 py-2 rounded-lg">
          <span class="text-xl font-bold">{{ match()!.homeScore ?? 0 }}</span>
          <span class="text-muted">-</span>
          <span class="text-xl font-bold">{{ match()!.awayScore ?? 0 }}</span>
        </div>

        <div class="flex items-center space-x-2">
          <span class="font-semibold">{{ match()!.awayTeamName }}</span>
          @if (match()!.awayTeamLogo) {
          <img
            [src]="match()!.awayTeamLogo"
            [alt]="match()!.awayTeamName"
            class="w-8 h-8 rounded-full object-cover"
          />
          }
        </div>
      </div>

      <div class="text-sm space-y-1 text-muted">
        <div class="flex items-center justify-center space-x-2">
          <lucide-angular [img]="icons.Calendar" size="16"></lucide-angular>
          <span>{{ match()!.matchDate | date : "medium" }}</span>
        </div>
        @if (match()!.venue) {
        <div class="flex items-center justify-center space-x-2">
          <lucide-angular [img]="icons.MapPin" size="16"></lucide-angular>
          <span>{{ match()!.venue }}</span>
        </div>
        }
      </div>
    </div>

    <div class="card">
      <h3 class="font-semibold mb-3">Match Events</h3>
      @if (matchEvents().length > 0) {
      <div class="space-y-2 max-h-64 overflow-y-auto">
        @for (event of matchEvents(); track event.id) {
        <div class="flex items-center space-x-3 p-3 rounded-lg">
          <div class="flex items-center space-x-2 min-w-0 flex-1">
            <lucide-angular
              [img]="getEventIcon(event.eventType)"
              size="16"
              [class]="getEventColor(event.eventType)"
            >
            </lucide-angular>
            <div class="min-w-0 flex-1">
              <div class="text-sm font-medium">{{ event.playerName }}</div>
              <div class="text-xs text-muted">{{ event.teamName }}</div>
            </div>
          </div>
          <div class="text-right">
            <div class="text-sm font-medium">{{ event.minute }}'</div>
            <div class="text-xs text-muted capitalize">
              {{ event.eventType }}
            </div>
          </div>
        </div>
        }
      </div>
      } @else {
      <div class="text-center text-muted py-8">
        <lucide-angular
          [img]="icons.Activity"
          size="24"
          class="mx-auto mb-2"
        ></lucide-angular>
        <p class="text-sm">No match events recorded</p>
      </div>
      }
    </div>

    <div class="card grid grid-cols-2 gap-6">
      <div>
        <h3 class="font-semibold mb-3 text-center">
          {{ match()!.homeTeamName }} Squad
        </h3>
        <div class="space-y-2">
          @for (player of homeTeamPlayers(); track player.id) {
          <div class="flex items-center space-x-2 p-2 rounded">
            <img
              [src]="player.photoUrl"
              [alt]="formatPlayerName(player)"
              class="w-6 h-6 rounded-full object-cover"
            />
            <div class="flex-1 min-w-0">
              <div class="text-sm font-medium truncate">
                {{ formatPlayerName(player) }}
              </div>
              @if (player.position) {
              <div class="text-xs text-muted">
                {{ getPosition(player.position) }}
              </div>
              }
            </div>
          </div>
          } @if (homeTeamPlayers().length === 0) {
          <div class="text-center text-muted py-4">
            <lucide-angular
              [img]="icons.Users"
              size="24"
              class="mx-auto mb-2"
            ></lucide-angular>
            <p class="text-sm">No players available</p>
          </div>
          }
        </div>
      </div>

      <div>
        <h3 class="font-semibold mb-3 text-center">
          {{ match()!.awayTeamName }} Squad
        </h3>
        <div class="space-y-2">
          @for (player of awayTeamPlayers(); track player.id) {
          <div
            class="flex items-center space-x-2 p-2 btn-outline border cursor-pointer rounded"
          >
            <img
              [src]="player.photoUrl"
              [alt]="formatPlayerName(player)"
              class="w-6 h-6 rounded-full object-cover"
            />
            <div class="flex-1 min-w-0">
              <div class="text-sm font-medium truncate">
                {{ formatPlayerName(player) }}
              </div>
              @if (player.position) {
              <div class="text-xs text-muted">
                {{ getPosition(player.position) }}
              </div>
              }
            </div>
          </div>
          } @if (awayTeamPlayers().length === 0) {
          <div class="text-center text-muted py-4">
            <lucide-angular
              [img]="icons.Users"
              size="24"
              class="mx-auto mb-2"
            ></lucide-angular>
            <p class="text-sm">No players available</p>
          </div>
          }
        </div>
      </div>
    </div>
  </div>
  }
</app-modal>
