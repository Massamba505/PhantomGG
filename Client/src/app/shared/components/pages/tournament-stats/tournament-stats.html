<div class="h-full flex flex-col">
  <!-- Header -->
  <div class="flex items-center justify-between mb-6">
    <div class="flex items-center gap-4">
      <button class="btn btn-outline btn-sm" (click)="goBack()">
        <lucide-angular [img]="icons.ArrowLeft" [size]="16" />
        Back
      </button>
      <div>
        <h1 class="text-2xl font-bold">{{ tournamentName() }} Statistics</h1>
        @if (tournament()) {
        <p class="text-sm text-muted">
          {{ formatDate(tournament()!.startDate) }} -
          {{ formatDate(tournament()!.endDate) }}
        </p>
        }
      </div>
    </div>

    <button
      class="btn btn-outline btn-sm"
      (click)="refresh()"
      [disabled]="isLoading()"
    >
      <lucide-angular
        [img]="icons.RefreshCw"
        [size]="16"
        [class.animate-spin]="isLoading()"
      />
      Refresh
    </button>
  </div>

  <!-- Stats Overview -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
    <div class="rounded-lg p-4 border">
      <div class="flex items-center gap-3">
        <div class="p-2 bg-blue-100 dark:bg-blue-900 rounded-lg">
          <lucide-angular
            [img]="icons.BarChart3"
            [size]="20"
            class="text-blue-600 dark:text-blue-400"
          />
        </div>
        <div>
          <p class="text-sm text-muted">Teams</p>
          <p class="text-xl font-bold text-muted">{{ standings().length }}</p>
        </div>
      </div>
    </div>

    <div class="rounded-lg p-4 border">
      <div class="flex items-center gap-3">
        <div class="p-2 bg-green-100 dark:bg-green-900 rounded-lg">
          <lucide-angular
            [img]="icons.Activity"
            [size]="20"
            class="text-success"
          />
        </div>
        <div>
          <p class="text-sm text-muted">Matches</p>
          <p class="text-xl font-bold text-muted">{{ totalMatches() }}</p>
        </div>
      </div>
    </div>

    <div class="rounded-lg p-4 border">
      <div class="flex items-center gap-3">
        <div class="p-2 bg-yellow-100 dark:bg-yellow-900 rounded-lg">
          <lucide-angular
            [img]="icons.Target"
            [size]="20"
            class="text-warning"
          />
        </div>
        <div>
          <p class="text-sm text-muted">Total Goals</p>
          <p class="text-xl font-bold text-muted">{{ totalGoals() }}</p>
        </div>
      </div>
    </div>

    <div class="rounded-lg p-4 border">
      <div class="flex items-center gap-3">
        <div class="p-2 bg-purple-100 dark:bg-purple-900 rounded-lg">
          <lucide-angular
            [img]="icons.Trophy"
            [size]="20"
            class="text-purple-600 dark:text-purple-400"
          />
        </div>
        <div>
          <p class="text-sm text-muted">Top Scorer</p>
          <p class="text-md font-medium text-muted">
            {{ topScorer()?.playerName || "N/A" }}
            @if (topScorer()) {
            <span class="text-xs text-muted">({{ topScorer()!.goals }})</span>
            }
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabs -->
  <div class="flex flex-wrap gap-0 sm:gap-2 text-muted border-b mb-6">
    <button (click)="onTabChange('table')" [class]="getTabClass('table')">
      <lucide-angular [img]="icons.BarChart3" [size]="16" class="inline mr-2" />
      League Table
      <span class="btn btn-outline px-2 py-0.5 ml-0.5 rounded-full">
        {{ standings().length }}
      </span>
    </button>
    <button (click)="onTabChange('goals')" [class]="getTabClass('goals')">
      <lucide-angular [img]="icons.Target" [size]="16" class="inline mr-2" />
      Top Scorers
      <span class="btn btn-outline px-2 py-0.5 ml-0.5 rounded-full">
        {{ goalStandings().length }}
      </span>
    </button>
    <button (click)="onTabChange('assists')" [class]="getTabClass('assists')">
      <lucide-angular [img]="icons.Users" [size]="16" class="inline mr-2" />
      Top Assists
      <span class="btn btn-outline px-2 py-0.5 ml-0.5 rounded-full">
        {{ assistStandings().length }}
      </span>
    </button>
  </div>

  <div class="flex-1 overflow-hidden">
    @if (isLoading()) {
    <div class="flex items-center justify-center h-64">
      <div class="flex items-center gap-3">
        <lucide-angular
          [img]="icons.Loader2"
          [size]="20"
          class="animate-spin"
        />
        <span>Loading statistics...</span>
      </div>
    </div>
    } @else { @if (activeTab() === 'table') {
    <div class="rounded-lg overflow-hidden border">
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="border-b">
            <tr>
              <th
                class="px-4 py-3 text-left text-xs font-medium text-muted uppercase"
              >
                Pos
              </th>
              <th
                class="px-4 py-3 text-left text-xs font-medium text-muted uppercase"
              >
                Team
              </th>
              <th
                class="px-4 py-3 text-center text-xs font-medium text-muted uppercase"
              >
                MP
              </th>
              <th
                class="px-4 py-3 text-center text-xs font-medium text-muted uppercase"
              >
                W
              </th>
              <th
                class="px-4 py-3 text-center text-xs font-medium text-muted uppercase"
              >
                D
              </th>
              <th
                class="px-4 py-3 text-center text-xs font-medium text-muted uppercase"
              >
                L
              </th>
              <th
                class="px-4 py-3 text-center text-xs font-medium text-muted uppercase"
              >
                GF
              </th>
              <th
                class="px-4 py-3 text-center text-xs font-medium text-muted uppercase"
              >
                GA
              </th>
              <th
                class="px-4 py-3 text-center text-xs font-medium text-muted uppercase"
              >
                GD
              </th>
              <th
                class="px-4 py-3 text-center text-xs font-medium text-muted uppercase"
              >
                Pts
              </th>
            </tr>
          </thead>
          <tbody class="divide-y">
            @for (team of standings(); track team.id; let i = $index) {
            <tr class="btn-outline">
              <td class="px-4 py-3 whitespace-nowrap">
                <div class="flex items-center gap-2">
                  <span
                    class="text-sm font-medium"
                    [class]="getPositionClass(i + 1)"
                  >
                    {{ i + 1 }}
                  </span>
                  @if (getPositionIcon(i + 1)) {
                  <lucide-angular
                    [img]="getPositionIcon(i + 1)"
                    [size]="14"
                    [class]="getPositionClass(i + 1)"
                  />
                  }
                </div>
              </td>
              <td class="px-4 py-3 whitespace-nowrap">
                <div class="flex items-center gap-3">
                  <img
                    [src]="team.teamLogo"
                    [alt]="team.teamName"
                    class="w-8 h-8 rounded-full object-cover"
                  />
                  <span class="text-sm font-medium">{{ team.teamName }}</span>
                </div>
              </td>
              <td class="px-4 py-3 text-center text-sm">
                {{ team.matchesPlayed }}
              </td>
              <td class="px-4 py-3 text-center text-sm text-success">
                {{ team.wins }}
              </td>
              <td class="px-4 py-3 text-center text-sm text-warning">
                {{ team.draws }}
              </td>
              <td class="px-4 py-3 text-center text-sm text-destructive">
                {{ team.losses }}
              </td>
              <td class="px-4 py-3 text-center text-sm">{{ team.goalsFor }}</td>
              <td class="px-4 py-3 text-center text-sm">
                {{ team.goalsAgainst }}
              </td>
              <td
                class="px-4 py-3 text-center text-sm"
                [class.text-success]="team.goalDifference > 0"
                [class.text-destructive]="team.goalDifference < 0"
              >
                {{ team.goalDifference > 0 ? "+" : ""
                }}{{ team.goalDifference }}
              </td>
              <td class="px-4 py-3 text-center text-sm font-bold">
                {{ team.points }}
              </td>
            </tr>
            } @if (standings().length === 0) {
            <tr>
              <td colspan="10" class="px-4 py-8 text-center text-muted">
                No standings data available
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
    }

    <!-- Top Scorers -->
    @if (activeTab() === 'goals') {
    <div class="rounded-lg overflow-hidden border">
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="border-b">
            <tr>
              <th
                class="px-4 py-3 text-left text-xs font-medium text-muted uppercase"
              >
                Rank
              </th>
              <th
                class="px-4 py-3 text-left text-xs font-medium text-muted uppercase"
              >
                Player
              </th>
              <th
                class="px-4 py-3 text-left text-xs font-medium text-muted uppercase"
              >
                Team
              </th>
              <th
                class="px-4 py-3 text-center text-xs font-medium text-muted uppercase"
              >
                Goals
              </th>
              <th
                class="px-4 py-3 text-center text-xs font-medium text-muted uppercase"
              >
                Matches
              </th>
              <th
                class="px-4 py-3 text-center text-xs font-medium text-muted uppercase"
              >
                Avg
              </th>
            </tr>
          </thead>
          <tbody class="divide-y">
            @for (player of goalStandings(); track player.playerId; let i =
            $index) {
            <tr class="btn-outline">
              <td class="px-4 py-3 whitespace-nowrap">
                <div class="flex items-center gap-2">
                  <span
                    class="text-sm font-medium"
                    [class]="getPositionClass(i + 1)"
                  >
                    {{ i + 1 }}
                  </span>
                  @if (getPositionIcon(i + 1)) {
                  <lucide-angular
                    [img]="getPositionIcon(i + 1)"
                    [size]="14"
                    [class]="getPositionClass(i + 1)"
                  />
                  }
                </div>
              </td>
              <td class="px-4 py-3 whitespace-nowrap">
                <div class="flex items-center gap-3">
                  <img
                    [src]="player.playerPhoto"
                    [alt]="player.playerName"
                    class="w-8 h-8 rounded-full object-cover"
                  />
                  <span class="text-sm font-medium">{{
                    player.playerName
                  }}</span>
                </div>
              </td>
              <td class="px-4 py-3 whitespace-nowrap">
                <div class="flex items-center gap-2">
                  <img
                    [src]="player.teamLogo"
                    [alt]="player.teamName"
                    class="w-6 h-6 rounded-full object-cover"
                  />
                  <span class="text-sm">{{ player.teamName }}</span>
                </div>
              </td>
              <td class="px-4 py-3 text-center text-sm font-bold text-success">
                {{ player.goals }}
              </td>
              <td class="px-4 py-3 text-center text-sm">
                {{ player.matchesPlayed }}
              </td>
              <td class="px-4 py-3 text-center text-sm">
                {{
                  player.matchesPlayed > 0
                    ? (player.goals / player.matchesPlayed).toFixed(2)
                    : "0.00"
                }}
              </td>
            </tr>
            } @if (goalStandings().length === 0) {
            <tr>
              <td colspan="6" class="px-4 py-8 text-center text-muted">
                No goal data available
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
    }

    <!-- Top Assists -->
    @if (activeTab() === 'assists') {
    <div class="rounded-lg overflow-hidden border">
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="border-b">
            <tr>
              <th
                class="px-4 py-3 text-left text-xs font-medium text-muted uppercase"
              >
                Rank
              </th>
              <th
                class="px-4 py-3 text-left text-xs font-medium text-muted uppercase"
              >
                Player
              </th>
              <th
                class="px-4 py-3 text-left text-xs font-medium text-muted uppercase"
              >
                Team
              </th>
              <th
                class="px-4 py-3 text-center text-xs font-medium text-muted uppercase"
              >
                Assists
              </th>
              <th
                class="px-4 py-3 text-center text-xs font-medium text-muted uppercase"
              >
                Matches
              </th>
              <th
                class="px-4 py-3 text-center text-xs font-medium text-muted uppercase"
              >
                Avg
              </th>
            </tr>
          </thead>
          <tbody class="divide-y">
            @for (player of assistStandings(); track player.playerId; let i =
            $index) {
            <tr class="btn-outline">
              <td class="px-4 py-3 whitespace-nowrap">
                <div class="flex items-center gap-2">
                  <span
                    class="text-sm font-medium"
                    [class]="getPositionClass(i + 1)"
                  >
                    {{ i + 1 }}
                  </span>
                  @if (getPositionIcon(i + 1)) {
                  <lucide-angular
                    [img]="getPositionIcon(i + 1)"
                    [size]="14"
                    [class]="getPositionClass(i + 1)"
                  />
                  }
                </div>
              </td>
              <td class="px-4 py-3 whitespace-nowrap">
                <div class="flex items-center gap-3">
                  <img
                    [src]="player.playerPhoto"
                    [alt]="player.playerName"
                    class="w-8 h-8 rounded-full object-cover"
                  />
                  <span class="text-sm font-medium">{{
                    player.playerName
                  }}</span>
                </div>
              </td>
              <td class="px-4 py-3 whitespace-nowrap">
                <div class="flex items-center gap-2">
                  <img
                    [src]="player.teamLogo"
                    [alt]="player.teamName"
                    class="w-6 h-6 rounded-full object-cover"
                  />
                  <span class="text-sm">{{ player.teamName }}</span>
                </div>
              </td>
              <td
                class="px-4 py-3 text-center text-sm font-bold text-blue-600 dark:text-blue-400"
              >
                {{ player.assists }}
              </td>
              <td class="px-4 py-3 text-center text-sm">
                {{ player.matchesPlayed }}
              </td>
              <td class="px-4 py-3 text-center text-sm">
                {{ player.assistsPerMatch.toFixed(2) }}
              </td>
            </tr>
            } @if (assistStandings().length === 0) {
            <tr>
              <td colspan="6" class="px-4 py-8 text-center text-muted">
                No assist data available
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
    } }
  </div>
</div>
