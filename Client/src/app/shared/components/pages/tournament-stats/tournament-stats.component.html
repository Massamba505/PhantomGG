<div class="h-full flex flex-col">
  <!-- Header -->
  <div class="flex items-center justify-between mb-6">
    <div class="flex items-center gap-4">
      @if (computedShowBackButton()) {
      <button class="btn btn-outline btn-sm" [routerLink]="computedBackRoute()">
        <lucide-angular [img]="icons.ArrowLeft" [size]="16" />
        Back
      </button>
      }
      <div>
        <h1 class="text-2xl font-bold text-gray-900 dark:text-gray-100">
          {{ tournamentName() }} Statistics
        </h1>
        @if (tournament()) {
        <p class="text-sm text-gray-600 dark:text-gray-400">
          {{ formatDate(tournament()!.startDate) }} -
          {{ formatDate(tournament()!.endDate) }}
        </p>
        }
      </div>
    </div>

    <button
      class="btn btn-outline btn-sm"
      (click)="refresh()"
      [disabled]="isLoading()"
    >
      <lucide-angular
        [img]="icons.RefreshCw"
        [size]="16"
        [class.animate-spin]="isLoading()"
      />
      Refresh
    </button>
  </div>

  <!-- Stats Overview -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
    <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border">
      <div class="flex items-center gap-3">
        <div class="p-2 bg-blue-100 dark:bg-blue-900 rounded-lg">
          <lucide-angular
            [img]="icons.BarChart3"
            [size]="20"
            class="text-blue-600 dark:text-blue-400"
          />
        </div>
        <div>
          <p class="text-sm text-gray-600 dark:text-gray-400">Teams</p>
          <p class="text-xl font-bold">{{ standings().length }}</p>
        </div>
      </div>
    </div>

    <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border">
      <div class="flex items-center gap-3">
        <div class="p-2 bg-green-100 dark:bg-green-900 rounded-lg">
          <lucide-angular
            [img]="icons.Activity"
            [size]="20"
            class="text-green-600 dark:text-green-400"
          />
        </div>
        <div>
          <p class="text-sm text-gray-600 dark:text-gray-400">Matches</p>
          <p class="text-xl font-bold">{{ totalMatches() }}</p>
        </div>
      </div>
    </div>

    <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border">
      <div class="flex items-center gap-3">
        <div class="p-2 bg-yellow-100 dark:bg-yellow-900 rounded-lg">
          <lucide-angular
            [img]="icons.Target"
            [size]="20"
            class="text-yellow-600 dark:text-yellow-400"
          />
        </div>
        <div>
          <p class="text-sm text-gray-600 dark:text-gray-400">Total Goals</p>
          <p class="text-xl font-bold">{{ totalGoals() }}</p>
        </div>
      </div>
    </div>

    <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border">
      <div class="flex items-center gap-3">
        <div class="p-2 bg-purple-100 dark:bg-purple-900 rounded-lg">
          <lucide-angular
            [img]="icons.Trophy"
            [size]="20"
            class="text-purple-600 dark:text-purple-400"
          />
        </div>
        <div>
          <p class="text-sm text-gray-600 dark:text-gray-400">Top Scorer</p>
          <p class="text-sm font-medium">
            {{ topScorer()?.playerName || "N/A" }}
            @if (topScorer()) {
            <span class="text-xs text-gray-500"
              >({{ topScorer()!.goals }})</span
            >
            }
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabs -->
  <div class="flex flex-wrap gap-0 sm:gap-2 border-b mb-6">
    <button (click)="onTabChange('table')" [class]="getTabClass('table')">
      <lucide-angular [img]="icons.BarChart3" [size]="16" class="inline mr-2" />
      League Table
      <span class="btn btn-outline px-2 py-0.5 ml-0.5 rounded-full">
        {{ standings().length }}
      </span>
    </button>
    <button (click)="onTabChange('goals')" [class]="getTabClass('goals')">
      <lucide-angular [img]="icons.Target" [size]="16" class="inline mr-2" />
      Top Scorers
      <span class="btn btn-outline px-2 py-0.5 ml-0.5 rounded-full">
        {{ goalStandings().length }}
      </span>
    </button>
    <button (click)="onTabChange('assists')" [class]="getTabClass('assists')">
      <lucide-angular [img]="icons.Users" [size]="16" class="inline mr-2" />
      Top Assists
      <span class="btn btn-outline px-2 py-0.5 ml-0.5 rounded-full">
        {{ assistStandings().length }}
      </span>
    </button>
  </div>

  <!-- Content -->
  <div class="flex-1 overflow-hidden">
    @if (isLoading()) {
    <div class="flex items-center justify-center h-64">
      <div class="flex items-center gap-3">
        <lucide-angular
          [img]="icons.Loader2"
          [size]="20"
          class="animate-spin"
        />
        <span>Loading statistics...</span>
      </div>
    </div>
    } @else {
    <!-- League Table -->
    @if (activeTab() === 'table') {
    <div class="bg-white dark:bg-gray-800 rounded-lg overflow-hidden border">
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="bg-gray-50 dark:bg-gray-700">
            <tr>
              <th
                class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"
              >
                Pos
              </th>
              <th
                class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"
              >
                Team
              </th>
              <th
                class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"
              >
                MP
              </th>
              <th
                class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"
              >
                W
              </th>
              <th
                class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"
              >
                D
              </th>
              <th
                class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"
              >
                L
              </th>
              <th
                class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"
              >
                GF
              </th>
              <th
                class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"
              >
                GA
              </th>
              <th
                class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"
              >
                GD
              </th>
              <th
                class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"
              >
                Pts
              </th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200 dark:divide-gray-600">
            @for (team of standings(); track team.id; let i = $index) {
            <tr class="hover:bg-gray-50 dark:hover:bg-gray-700">
              <td class="px-4 py-3 whitespace-nowrap">
                <div class="flex items-center gap-2">
                  <span
                    class="text-sm font-medium"
                    [class]="getPositionClass(i + 1)"
                  >
                    {{ i + 1 }}
                  </span>
                  @if (getPositionIcon(i + 1)) {
                  <lucide-angular
                    [img]="getPositionIcon(i + 1)"
                    [size]="14"
                    [class]="getPositionClass(i + 1)"
                  />
                  }
                </div>
              </td>
              <td class="px-4 py-3 whitespace-nowrap">
                <div class="flex items-center gap-3">
                  @if (team.teamLogo) {
                  <img
                    [src]="team.teamLogo"
                    [alt]="team.teamName"
                    class="w-8 h-8 rounded-full object-cover"
                  />
                  } @else {
                  <div
                    class="w-8 h-8 bg-gray-200 dark:bg-gray-600 rounded-full flex items-center justify-center"
                  >
                    <span class="text-xs font-medium">{{
                      getTeamInitials(team.teamName)
                    }}</span>
                  </div>
                  }
                  <span class="text-sm font-medium">{{ team.teamName }}</span>
                </div>
              </td>
              <td class="px-4 py-3 text-center text-sm">
                {{ team.matchesPlayed }}
              </td>
              <td
                class="px-4 py-3 text-center text-sm text-green-600 dark:text-green-400"
              >
                {{ team.wins }}
              </td>
              <td
                class="px-4 py-3 text-center text-sm text-yellow-600 dark:text-yellow-400"
              >
                {{ team.draws }}
              </td>
              <td
                class="px-4 py-3 text-center text-sm text-red-600 dark:text-red-400"
              >
                {{ team.losses }}
              </td>
              <td class="px-4 py-3 text-center text-sm">{{ team.goalsFor }}</td>
              <td class="px-4 py-3 text-center text-sm">
                {{ team.goalsAgainst }}
              </td>
              <td
                class="px-4 py-3 text-center text-sm"
                [class.text-green-600]="team.goalDifference > 0"
                [class.text-red-600]="team.goalDifference < 0"
                [class.dark:text-green-400]="team.goalDifference > 0"
                [class.dark:text-red-400]="team.goalDifference < 0"
              >
                {{ team.goalDifference > 0 ? "+" : ""
                }}{{ team.goalDifference }}
              </td>
              <td class="px-4 py-3 text-center text-sm font-bold">
                {{ team.points }}
              </td>
            </tr>
            } @if (standings().length === 0) {
            <tr>
              <td
                colspan="10"
                class="px-4 py-8 text-center text-gray-500 dark:text-gray-400"
              >
                No standings data available
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
    }

    <!-- Top Scorers -->
    @if (activeTab() === 'goals') {
    <div class="bg-white dark:bg-gray-800 rounded-lg overflow-hidden border">
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="bg-gray-50 dark:bg-gray-700">
            <tr>
              <th
                class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"
              >
                Rank
              </th>
              <th
                class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"
              >
                Player
              </th>
              <th
                class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"
              >
                Team
              </th>
              <th
                class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"
              >
                Goals
              </th>
              <th
                class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"
              >
                Matches
              </th>
              <th
                class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"
              >
                Avg
              </th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200 dark:divide-gray-600">
            @for (player of goalStandings(); track player.playerId; let i =
            $index) {
            <tr class="hover:bg-gray-50 dark:hover:bg-gray-700">
              <td class="px-4 py-3 whitespace-nowrap">
                <div class="flex items-center gap-2">
                  <span
                    class="text-sm font-medium"
                    [class]="getPositionClass(i + 1)"
                  >
                    {{ i + 1 }}
                  </span>
                  @if (getPositionIcon(i + 1)) {
                  <lucide-angular
                    [img]="getPositionIcon(i + 1)"
                    [size]="14"
                    [class]="getPositionClass(i + 1)"
                  />
                  }
                </div>
              </td>
              <td class="px-4 py-3 whitespace-nowrap">
                <div class="flex items-center gap-3">
                  @if (player.playerPhoto) {
                  <img
                    [src]="player.playerPhoto"
                    [alt]="player.playerName"
                    class="w-8 h-8 rounded-full object-cover"
                  />
                  } @else {
                  <div
                    class="w-8 h-8 bg-gray-200 dark:bg-gray-600 rounded-full flex items-center justify-center"
                  >
                    <span class="text-xs font-medium">{{
                      getPlayerInitials(player.playerName)
                    }}</span>
                  </div>
                  }
                  <span class="text-sm font-medium">{{
                    player.playerName
                  }}</span>
                </div>
              </td>
              <td class="px-4 py-3 whitespace-nowrap">
                <div class="flex items-center gap-2">
                  @if (player.teamLogo) {
                  <img
                    [src]="player.teamLogo"
                    [alt]="player.teamName"
                    class="w-6 h-6 rounded-full object-cover"
                  />
                  }
                  <span class="text-sm">{{ player.teamName }}</span>
                </div>
              </td>
              <td
                class="px-4 py-3 text-center text-sm font-bold text-green-600 dark:text-green-400"
              >
                {{ player.goals }}
              </td>
              <td class="px-4 py-3 text-center text-sm">
                {{ player.matchesPlayed }}
              </td>
              <td class="px-4 py-3 text-center text-sm">
                {{
                  player.matchesPlayed > 0
                    ? (player.goals / player.matchesPlayed).toFixed(2)
                    : "0.00"
                }}
              </td>
            </tr>
            } @if (goalStandings().length === 0) {
            <tr>
              <td
                colspan="6"
                class="px-4 py-8 text-center text-gray-500 dark:text-gray-400"
              >
                No goal data available
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
    }

    <!-- Top Assists -->
    @if (activeTab() === 'assists') {
    <div class="bg-white dark:bg-gray-800 rounded-lg overflow-hidden border">
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="bg-gray-50 dark:bg-gray-700">
            <tr>
              <th
                class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"
              >
                Rank
              </th>
              <th
                class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"
              >
                Player
              </th>
              <th
                class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"
              >
                Team
              </th>
              <th
                class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"
              >
                Assists
              </th>
              <th
                class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"
              >
                Matches
              </th>
              <th
                class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"
              >
                Avg
              </th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200 dark:divide-gray-600">
            @for (player of assistStandings(); track player.playerId; let i =
            $index) {
            <tr class="hover:bg-gray-50 dark:hover:bg-gray-700">
              <td class="px-4 py-3 whitespace-nowrap">
                <div class="flex items-center gap-2">
                  <span
                    class="text-sm font-medium"
                    [class]="getPositionClass(i + 1)"
                  >
                    {{ i + 1 }}
                  </span>
                  @if (getPositionIcon(i + 1)) {
                  <lucide-angular
                    [img]="getPositionIcon(i + 1)"
                    [size]="14"
                    [class]="getPositionClass(i + 1)"
                  />
                  }
                </div>
              </td>
              <td class="px-4 py-3 whitespace-nowrap">
                <div class="flex items-center gap-3">
                  @if (player.playerPhoto) {
                  <img
                    [src]="player.playerPhoto"
                    [alt]="player.playerName"
                    class="w-8 h-8 rounded-full object-cover"
                  />
                  } @else {
                  <div
                    class="w-8 h-8 bg-gray-200 dark:bg-gray-600 rounded-full flex items-center justify-center"
                  >
                    <span class="text-xs font-medium">{{
                      getPlayerInitials(player.playerName)
                    }}</span>
                  </div>
                  }
                  <span class="text-sm font-medium">{{
                    player.playerName
                  }}</span>
                </div>
              </td>
              <td class="px-4 py-3 whitespace-nowrap">
                <div class="flex items-center gap-2">
                  @if (player.teamLogo) {
                  <img
                    [src]="player.teamLogo"
                    [alt]="player.teamName"
                    class="w-6 h-6 rounded-full object-cover"
                  />
                  }
                  <span class="text-sm">{{ player.teamName }}</span>
                </div>
              </td>
              <td
                class="px-4 py-3 text-center text-sm font-bold text-blue-600 dark:text-blue-400"
              >
                {{ player.assists }}
              </td>
              <td class="px-4 py-3 text-center text-sm">
                {{ player.matchesPlayed }}
              </td>
              <td class="px-4 py-3 text-center text-sm">
                {{ player.assistsPerMatch.toFixed(2) }}
              </td>
            </tr>
            } @if (assistStandings().length === 0) {
            <tr>
              <td
                colspan="6"
                class="px-4 py-8 text-center text-gray-500 dark:text-gray-400"
              >
                No assist data available
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
    } }
  </div>
</div>
