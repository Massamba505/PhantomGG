<div class="flex items-center justify-between gap-4 mb-4">
  <button class="btn btn-outline" (click)="goBack()">
    <lucide-angular [img]="icons.ArrowLeft" [size]="20"></lucide-angular>
    Back
  </button>

  @if (tournament()) {
  <div class="flex gap-2">
    <button class="btn btn-primary" (click)="editTournament()">
      Edit Tournament
    </button>
    <button class="btn btn-destructive" (click)="deleteTournament()">
      Delete
    </button>
  </div>
  }
</div>

@if (loading()) {
<div class="text-center py-12">
  <p>Loading tournament details...</p>
</div>
} @if (!loading() && tournament()) {
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
  <div class="lg:col-span-2 space-y-6">
    <div class="card">
      <div
        class="tournament-banner mb-4"
        [style.background-image]="
          tournament()!.bannerUrl
            ? 'url(' + tournament()!.bannerUrl + ')'
            : 'none'
        "
        [style.background-size]="'cover'"
        [style.background-position]="'center'"
      >
        @if (!tournament()!.bannerUrl) {
        <div class="h-full flex items-center justify-center">
          <span class="opacity-50">No banner uploaded</span>
        </div>
        }
      </div>
    </div>

    <div class="card">
      <p class="font-semibold text-3xl underline mb-3">
        {{ tournament()!.name }}
      </p>
      <p
        class="leading-relaxed"
        [innerHTML]="tournament()!.description | appLineBreaks"
      ></p>
    </div>

    <div class="card">
      <div class="flex justify-between items-center mb-4">
        <h2 class="font-semibold text-lg">Team Management</h2>
        <span class="status-badge">
          {{ tournament()!.teamCount }}/{{ tournament()!.maxTeams }} Teams
        </span>
      </div>

      <app-tournament-team-management [tournamentId]="tournament()!.id">
      </app-tournament-team-management>
    </div>
  </div>

  <div class="space-y-6">
    <div class="card">
      <h3 class="font-semibold mb-4">Tournament Info</h3>
      <div class="space-y-3">
        <div class="flex justify-between">
          <span class="opacity-75 flex items-center gap-2">
            <lucide-angular [img]="icons.Activity" [size]="16"></lucide-angular>
            Status:
          </span>
          <span class="status-badge">{{ tournament()!.status }}</span>
        </div>

        <div class="flex justify-between">
          <span class="opacity-75 flex items-center gap-2">
            <lucide-angular
              [img]="icons.LayoutGrid"
              [size]="16"
            ></lucide-angular>
            Format:
          </span>
          <span>Standard Tournament</span>
        </div>

        <div class="flex justify-between">
          <span class="opacity-75 flex items-center gap-2">
            <lucide-angular [img]="icons.Calendar" [size]="16"></lucide-angular>
            Start Date:
          </span>
          <span>{{ tournament()!.startDate | date : "short" }}</span>
        </div>

        <!-- Entry fee and prize pool sections removed - not supported in backend -->
        @if (tournament()!.location) {
        <div class="flex justify-between">
          <span class="opacity-75 flex items-center gap-2">
            <lucide-angular [img]="icons.MapPin" [size]="16"></lucide-angular>
            Location:
          </span>
          <span>{{ tournament()!.location }}</span>
        </div>
        }
      </div>
    </div>

    <div class="card">
      <h3 class="font-semibold mb-4">Registration</h3>

      <div class="space-y-3">
        @if (tournament()!.registrationStartDate) {
        <div class="flex justify-between">
          <span class="opacity-75 flex items-center gap-2">
            <lucide-angular [img]="icons.Play" [size]="16"></lucide-angular>
            Opens:
          </span>
          <span>{{
            tournament()!.registrationStartDate | date : "short"
          }}</span>
        </div>
        } @if (tournament()!.registrationDeadline) {
        <div class="flex justify-between">
          <span class="opacity-75 flex items-center gap-2">
            <lucide-angular [img]="icons.Clock" [size]="16"></lucide-angular>
            Deadline:
          </span>
          <span>{{ tournament()!.registrationDeadline | date : "short" }}</span>
        </div>
        }

        <div class="flex justify-between">
          <span class="opacity-75 flex items-center gap-2">
            <lucide-angular [img]="icons.Users" [size]="16"></lucide-angular>
            Min Teams:
          </span>
          <span>{{ tournament()!.minTeams }}</span>
        </div>

        <div class="flex justify-between">
          <span class="opacity-75 flex items-center gap-2">
            <lucide-angular [img]="icons.Users" [size]="16"></lucide-angular>
            Max Teams:
          </span>
          <span>{{ tournament()!.maxTeams }}</span>
        </div>

        <div class="flex justify-between">
          <span class="opacity-75 flex items-center gap-2">
            <lucide-angular [img]="icons.UserPlus" [size]="16"></lucide-angular>
            Players/Team:
          </span>
          <span> 11 (Standard team size) </span>
        </div>
      </div>
    </div>

    <div class="card">
      <h3 class="font-semibold mb-4">Contact</h3>
      <div class="space-y-2">
        <div class="flex justify-between">
          <span class="opacity-75 flex items-center gap-2">
            <lucide-angular [img]="icons.User" [size]="16"></lucide-angular>
            Organizer:
          </span>

          <div class="flex items-center gap-3">
            <span>
              {{ tournament()!.organizer?.firstName }}
              {{ tournament()!.organizer?.lastName }}
            </span>
            <img
              [src]="tournament()!.organizer?.profilePictureUrl"
              alt="Organizer's Profile Picture"
              class="w-8 h-8 rounded-full object-contain"
            />
          </div>
        </div>

        <div class="flex justify-between">
          <span class="opacity-75 flex items-center gap-2">
            <lucide-angular [img]="icons.Mail" [size]="16"></lucide-angular>
            Email:
          </span>
          <a
            href="mailto:{{ tournament()!.organizer?.email }}"
            class="text-blue-500 hover:underline"
          >
            {{ tournament()!.organizer?.email }}
          </a>
        </div>
      </div>
    </div>
  </div>
</div>
}

<app-confirm-delete-modal
  [isOpen]="showDeleteModal()"
  [title]="'Delete Tournament'"
  [entityName]="'Tournament'"
  [isLoading]="isDeleting()"
  (close)="closeDeleteModal()"
  (confirm)="confirmDelete()"
></app-confirm-delete-modal>
