<form [formGroup]="tournamentForm" (ngSubmit)="onSubmit()" class="space-y-6">
  <div class="card">
    <h3 class="font-semibold text-lg mb-4">Basic Information</h3>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label class="form-label"
          >Tournament Name <span class="required">*</span></label
        >
        <input
          type="text"
          class="input-field"
          formControlName="name"
          placeholder="Enter tournament name"
        />
        @if (tournamentForm.get('name')?.invalid &&
        tournamentForm.get('name')?.touched) {
        <div class="error-message">Tournament name is required</div>
        }
      </div>

      <div>
        <label class="form-label"
          >Tournament Format <span class="required">*</span></label
        >
        <select class="form-select" formControlName="format">
          <option value="">Select a format</option>
          @for (format of formats(); track format.id) {
          <option [value]="format.id">
            {{ format.name }}
          </option>
          }
        </select>
        @if (tournamentForm.get('format')?.invalid &&
        tournamentForm.get('format')?.touched) {
        <div class="error-message">Please select a tournament format</div>
        }
      </div>
    </div>

    <div class="mt-4">
      <label class="form-label"
        >Description <span class="required">*</span></label
      >
      <textarea
        class="textarea"
        formControlName="description"
        placeholder="Describe your tournament..."
        rows="5"
      ></textarea>
      @if (tournamentForm.get('description')?.invalid &&
      tournamentForm.get('description')?.touched) {
      <div class="error-message">Description is required</div>
      }
    </div>

    <div class="mt-4">
      <label class="form-label">Location</label>
      <input
        type="text"
        class="input-field"
        formControlName="location"
        placeholder="Tournament location (optional)"
      />
    </div>
  </div>

  @if (isEdit()) {

  <div class="card">
    <h3 class="font-semibold text-lg mb-4">Tournament Media</h3>

    <div class="space-y-6">
      <!-- Banner Upload -->
      <div>
        <label class="block text-sm font-medium mb-2">Tournament Banner</label>

        <div
          class="relative border-2 border-dashed border-gray-300 rounded-xl flex items-center justify-center cursor-pointer transition"
          style="width: 100%; max-width: 600px; height: 200px"
          (click)="bannerFileInput.click()"
        >
          <input
            type="file"
            #bannerFileInput
            accept="image/*"
            class="hidden"
            (change)="onBannerChange($event)"
          />

          @if (!bannerPreview() && !currentBannerUrl()) {
          <div class="text-center px-4">
            <p class="text-sm font-medium">
              <span class="text-blue-600 underline">Click to upload</span>
              tournament banner
            </p>
            <p class="text-xs opacity-75 mt-1">
              Recommended: 1200x400px (PNG, JPG up to 5MB)
            </p>
          </div>
          } @else {
          <img
            [src]="bannerPreview() || currentBannerUrl()"
            alt="Banner Preview"
            class="absolute inset-0 w-full h-full object-contain rounded-xl"
          />
          <div
            class="absolute inset-0 bg-opacity-50 rounded-xl flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity"
          >
            <p class="text-white text-sm font-medium">Click to change banner</p>
          </div>
          } @if (uploadingBanner()) {
          <div
            class="absolute inset-0 bg-white bg-opacity-90 rounded-xl flex items-center justify-center"
          >
            <div class="flex items-center gap-2 text-sm text-blue-600">
              <div
                class="animate-spin w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full"
              ></div>
              Uploading banner...
            </div>
          </div>
          }
        </div>
      </div>

      <!-- Logo Upload -->
      <div>
        <label class="block text-sm font-medium mb-2">Tournament Logo</label>
        <div
          class="relative border-2 border-dashed border-gray-300 rounded-xl flex items-center justify-center cursor-pointer transition"
          style="width: 200px; height: 200px"
          (click)="logoFileInput.click()"
        >
          <input
            type="file"
            #logoFileInput
            accept="image/*"
            class="hidden"
            (change)="onLogoChange($event)"
          />

          @if (!logoPreview() && !currentLogoUrl()) {
          <div class="text-center px-4">
            <p class="text-xs font-medium">
              <span class="text-blue-600 underline">Click to upload</span>
            </p>
            <p class="text-xs opacity-75 mt-1">200x200px</p>
            <p class="text-xs opacity-75">(PNG, JPG up to 5MB)</p>
          </div>
          } @else {
          <img
            [src]="logoPreview() || currentLogoUrl()"
            alt="Logo Preview"
            class="absolute inset-0 w-full h-full object-contain rounded-xl"
          />
          <div
            class="absolute inset-0 bg-black bg-opacity-50 rounded-xl flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity"
          >
            <p class="text-white text-xs font-medium text-center">
              Click to change logo
            </p>
          </div>
          } @if (uploadingLogo()) {
          <div
            class="absolute inset-0 bg-white bg-opacity-90 rounded-xl flex items-center justify-center"
          >
            <div class="flex flex-col items-center gap-2 text-xs text-blue-600">
              <div
                class="animate-spin w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full"
              ></div>
              <span>Uploading...</span>
            </div>
          </div>
          }
        </div>
      </div>
    </div>
  </div>
  }

  <div class="card">
    <h3 class="font-semibold text-lg mb-4">Schedule</h3>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div>
        <label class="form-label"
          >Registration Start <span class="required">*</span></label
        >
        <input
          type="datetime-local"
          class="input-field"
          formControlName="registrationStartDate"
          [min]="todayDateTime"
        />
        @if (getFieldError('registrationStartDate')) {
        <div class="error-message">
          {{ getFieldError("registrationStartDate") }}
        </div>
        }
      </div>

      <div>
        <label class="form-label"
          >Registration Deadline <span class="required">*</span></label
        >
        <input
          type="datetime-local"
          class="input-field"
          formControlName="registrationDeadline"
          [min]="todayDateTime"
        />
        @if (getFieldError('registrationDeadline')) {
        <div class="error-message">
          {{ getFieldError("registrationDeadline") }}
        </div>
        }
      </div>

      <div>
        <label class="form-label"
          >Start Date <span class="required">*</span></label
        >
        <input
          type="datetime-local"
          class="input-field"
          formControlName="startDate"
          [min]="todayDateTime"
        />
        @if (getFieldError('startDate')) {
        <div class="error-message">{{ getFieldError("startDate") }}</div>
        }
      </div>
    </div>
  </div>

  <div class="card">
    <h3 class="font-semibold text-lg mb-4">Teams & Players</h3>

    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
      <div>
        <label class="form-label"
          >Min Teams <span class="required">*</span></label
        >
        <input
          type="number"
          class="input-field"
          formControlName="minTeams"
          min="2"
          max="64"
        />
      </div>

      <div>
        <label class="form-label"
          >Max Teams <span class="required">*</span></label
        >
        <input
          type="number"
          class="input-field"
          formControlName="maxTeams"
          min="4"
          max="128"
        />
      </div>

      <div>
        <label class="form-label"
          >Min Players/Team <span class="required">*</span></label
        >
        <input
          type="number"
          class="input-field"
          formControlName="minPlayersPerTeam"
          min="7"
          max="25"
        />
      </div>

      <div>
        <label class="form-label"
          >Max Players/Team <span class="required">*</span></label
        >
        <input
          type="number"
          class="input-field"
          formControlName="maxPlayersPerTeam"
          min="7"
          max="25"
        />
      </div>
    </div>
  </div>

  <div class="card">
    <h3 class="font-semibold text-lg mb-4">Financial</h3>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label class="form-label">Entry Fee (R)</label>
        <input
          type="number"
          class="input-field"
          formControlName="entryFee"
          min="0"
          step="0.01"
          placeholder="0.00"
        />
      </div>

      <div>
        <label class="form-label">Prize Pool (R)</label>
        <input
          type="number"
          class="input-field"
          formControlName="prizePool"
          min="0"
          step="0.01"
          placeholder="0.00"
        />
      </div>
    </div>
  </div>

  <div class="card">
    <h3 class="font-semibold text-lg mb-4">Settings</h3>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label class="form-label">Contact Email</label>
        <input
          type="email"
          class="input-field"
          formControlName="contactEmail"
          placeholder="contact@tournament.com"
        />
      </div>

      <div>
        <label class="form-label"
          >Match Duration (minutes) <span class="required">*</span></label
        >
        <input
          type="number"
          class="input-field"
          formControlName="matchDuration"
          min="0"
          max="120"
        />
      </div>
    </div>

    <div class="mt-4">
      <label class="flex items-center gap-2">
        <input type="checkbox" class="checkbox" formControlName="isPublic" />
        <span class="form-label mb-0">Make tournament public</span>
      </label>
      <p class="text-sm opacity-75 mt-1">
        Public tournaments can be discovered by all users
      </p>
    </div>
  </div>

  <div class="flex gap-4 justify-end">
    <button
      type="button"
      class="btn btn-outline"
      (click)="onCancel()"
      [disabled]="loading()"
    >
      Cancel
    </button>
    <button
      type="submit"
      class="btn btn-primary"
      [disabled]="tournamentForm.invalid || loading()"
    >
      @if (loading()) { Saving... } @else { @if (isEdit()) { Update Tournament }
      @else { Create Tournament } }
    </button>
  </div>
</form>
