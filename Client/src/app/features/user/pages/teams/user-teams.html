<div class="h-full flex flex-col" data-cy="user-teams-container">
  <div class="flex justify-between items-center mb-4" data-cy="teams-header">
    <h1 class="text-2xl font-bold" data-cy="teams-title">My Teams</h1>
    <button class="btn btn-primary" routerLink="/user/teams/create" data-cy="create-team-button">
      <lucide-angular [img]="icons.CirclePlus" [size]="20" data-cy="create-icon"></lucide-angular>
      Create Team
    </button>
  </div>

  <app-team-search
    (clearFiltersSearch)="onClearSearch()"
    (searchChange)="onSearchChange($event)"
    data-cy="team-search"
  ></app-team-search>

  @if (isLoading()) {
  <div class="text-center py-12" data-cy="loading-state">
    <div
      class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mb-4"
      data-cy="loading-spinner"
    ></div>
    <p class="text-gray-600" data-cy="loading-text">Loading teams...</p>
  </div>
  } @if (!isLoading() && teams().length === 0) {
  <div class="text-center py-12" data-cy="empty-state">
    <div class="text-gray-400 mb-3" data-cy="empty-icon-container">
      <lucide-angular
        [img]="icons.Users"
        [size]="64"
        class="mx-auto"
        data-cy="empty-teams-icon"
      ></lucide-angular>
    </div>
    @if (searchCriteria().q) {
    <h3 class="text-xl font-semibold mb-2" data-cy="no-teams-found-title">No teams found</h3>
    <p class="text-gray-600 mb-4" data-cy="no-teams-found-description">
      No teams match your search criteria. Try adjusting your search terms.
    </p>
    <button class="btn btn-outline mr-2" (click)="onClearSearch()" data-cy="clear-search-button">
      <lucide-angular [img]="icons.X" [size]="16" data-cy="clear-icon"></lucide-angular>
      Clear Search
    </button>
    } @else {
    <h3 class="text-xl font-semibold mb-2" data-cy="no-teams-title">No teams found</h3>
    <p class="text-gray-600 mb-4" data-cy="no-teams-description">
      You haven't created any teams yet. Create your first team to get started.
    </p>
    }
    <button class="btn btn-primary" routerLink="/user/teams/create" data-cy="create-first-team-button">
      <lucide-angular [img]="icons.CirclePlus" [size]="20" data-cy="create-first-icon"></lucide-angular>
      Create {{ searchCriteria().q ? "New" : "Your First" }} Team
    </button>
  </div>
  } @if (!isLoading() && teams().length > 0) {
  <div class="flex items-center mb-4" data-cy="teams-info">
    @if (totalCount() > 0) {
    <span class="text-sm opacity-75" data-cy="teams-count">{{ totalCount() }} Teams</span>
    }
  </div>

  <div class="flex-1" data-cy="teams-grid-container">
    <div
      class="grid grid-cols-1 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 justify-center gap-6"
      data-cy="teams-grid"
     >
      @for (team of teams(); track team.id) {
      <app-team-card
        [team]="team"
        [role]="getTeamRole()"
        (edit)="onTeamEdit($event)"
        (delete)="onTeamDelete($event)"
        (view)="onTeamView($event)"
        data-cy="team-card-item"
      ></app-team-card>
      }
    </div>
  </div>

  <div
    class="flex flex-col sm:flex-row justify-between flex-wrap items-center gap-4 pt-4 border-t mt-auto"
    data-cy="pagination-controls"
  >
    <div class="flex items-center gap-2 mx-auto" data-cy="page-size-controls">
      <label class="text-sm font-medium" data-cy="page-size-label">Show:</label>
      <select
        class="input-field text-sm py-1 px-2 min-w-0"
        [value]="pageSize()"
        (change)="onPageSizeSelectChange($event)"
        data-cy="page-size-select"
      >
        <option value="6" data-cy="page-size-6">6 per page</option>
        <option value="12" data-cy="page-size-12">12 per page</option>
        <option value="24" data-cy="page-size-24">24 per page</option>
        <option value="48" data-cy="page-size-48">48 per page</option>
      </select>
    </div>

    @if (totalPages() > 1) {
    <div class="text-sm opacity-75 mx-auto" data-cy="pagination-info">
      Page {{ currentPage() }} of {{ totalPages() }} ({{ totalCount() }} total)
    </div>
    <div class="flex items-center gap-1 mx-auto" data-cy="pagination-buttons">
      <button
        class="btn btn-secondary btn-sm"
        [disabled]="!hasPreviousPage()"
        (click)="onPageChange(1)"
        title="First page"
        data-cy="first-page-button"
      >
        <lucide-angular [img]="icons.ChevronsLeft" size="16" data-cy="first-page-icon" />
      </button>
      <button
        class="btn btn-secondary btn-sm"
        [disabled]="!hasPreviousPage()"
        (click)="onPageChange(currentPage() - 1)"
        title="Previous page"
        data-cy="previous-page-button"
      >
        <lucide-angular [img]="icons.ChevronLeft" size="16" data-cy="previous-page-icon" />
      </button>

      @for (pageNum of getPageNumbers(); track pageNum) {
      <button
        class="btn btn-sm"
        [class.btn-primary]="pageNum === currentPage()"
        [class.btn-secondary]="pageNum !== currentPage()"
        (click)="onPageChange(pageNum)"
        [attr.data-cy]="'page-' + pageNum + '-button'"
      >
        {{ pageNum }}
      </button>
      }

      <button
        class="btn btn-secondary btn-sm"
        [disabled]="!hasNextPage()"
        (click)="onPageChange(currentPage() + 1)"
        title="Next page"
        data-cy="next-page-button"
      >
        <lucide-angular [img]="icons.ChevronRight" size="16" data-cy="next-page-icon" />
      </button>
      <button
        class="btn btn-secondary btn-sm"
        [disabled]="!hasNextPage()"
        (click)="onPageChange(totalPages())"
        title="Last page"
        data-cy="last-page-button"
      >
        <lucide-angular [img]="icons.ChevronsRight" size="16" data-cy="last-page-icon" />
      </button>
    </div>
    }
  </div>
  }
</div>
