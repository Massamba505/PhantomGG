<div class="flex items-center justify-between gap-4 mb-6">
  <button class="btn btn-outline" (click)="onBackToTeams()">
    <lucide-angular [img]="icons.ArrowLeft" [size]="20"></lucide-angular>
    Back to Teams
  </button>

  @if (team()) {
  <div class="flex gap-2">
    <button class="btn btn-outline" (click)="onEditTeam()">
      <lucide-angular [img]="icons.Edit" [size]="16"></lucide-angular>
      Edit Team
    </button>
  </div>
  }
</div>

@if (loading()) {
<div class="text-center py-12">
  <p>Loading team details...</p>
</div>
} @else if (!loading() && team()) {
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
  <div class="lg:col-span-2 space-y-6">
    <div class="card">
      <div class="flex items-center gap-4 mb-4">
        @if (team()!.logoUrl) {
        <img
          [src]="team()!.logoUrl"
          [alt]="team()!.name + ' logo'"
          class="w-32 h-32 rounded-lg object-contain"
        />
        } @else {
        <div
          class="w-20 h-20 rounded-lg flex items-center justify-center text-xl font-semibold"
        >
          {{ team()!.name.charAt(0).toUpperCase() }}
        </div>
        }
        <div>
          <h1 class="font-bold text-3xl">{{ team()!.name }}</h1>
          @if (team()!.shortName) {
          <p class="opacity-75 text-lg">{{ team()!.shortName }}</p>
          }
        </div>
      </div>
    </div>

    <div class="card">
      <div class="flex justify-between items-center mb-6">
        <h2 class="font-bold text-xl flex items-center gap-2">
          <lucide-angular [img]="icons.Users" [size]="24"></lucide-angular>
          Team Players
        </h2>
        <button class="btn btn-primary" (click)="onShowAddPlayer()">
          <lucide-angular [img]="icons.Plus" [size]="16"></lucide-angular>
          Add Player
        </button>
      </div>

      @if (players().length > 0) {
      <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-1">
        @for (player of players(); track player.id) {
        <div class="card relative">
          <div class="flex items-start gap-3">
            <img
              [src]="player.photoUrl"
              [alt]="player.firstName + ' ' + player.lastName"
              class="w-16 h-16 rounded-full object-contain"
            />
            <div class="flex-1">
              <h3 class="font-semibold text-lg">
                {{ player.firstName }} {{ player.lastName }}
              </h3>
              @if (player.position) {
              <p class="text-sm text-gray-600 mb-1">{{ player.position }}</p>
              } @if (player.email) {
              <p class="text-sm text-gray-500 truncate">{{ player.email }}</p>
              }
              <p class="text-xs text-gray-400 mt-2">
                Joined {{ player.joinedAt | date : "short" }}
              </p>
            </div>
          </div>

          <div class="flex gap-2 absolute right-3 bottom-3">
            <button class="btn btn-outline" (click)="onEditPlayer(player)">
              <lucide-angular [img]="icons.Edit" [size]="12"></lucide-angular>
            </button>
            <button
              class="btn btn-destructive"
              (click)="onRemovePlayer(player)"
            >
              <lucide-angular [img]="icons.Trash2" [size]="12"></lucide-angular>
            </button>
          </div>
        </div>
        }
      </div>
      } @else {
      <div class="text-center py-12 rounded-lg">
        <lucide-angular
          [img]="icons.Users"
          [size]="48"
          class="mx-auto mb-4 text-gray-400"
        ></lucide-angular>
        <h3 class="text-lg font-semibold text-gray-600 mb-2">No Players Yet</h3>
        <p class="text-gray-500 mb-4">
          Start building your team by adding your first player
        </p>
        <button class="btn btn-primary" (click)="onShowAddPlayer()">
          <lucide-angular [img]="icons.Plus" [size]="16"></lucide-angular>
          Add First Player
        </button>
      </div>
      }
    </div>
  </div>

  <div class="space-y-6">
    <div class="card">
      <h3 class="font-semibold text-lg mb-4 flex items-center gap-2">
        <lucide-angular [img]="icons.BarChart3" [size]="20"></lucide-angular>
        Team Statistics
      </h3>
      <div class="space-y-4">
        <div class="flex justify-between items-center">
          <span class="opacity-75">Total Players</span>
          <span class="font-semibold text-lg">{{ players().length }}</span>
        </div>
        <div class="flex justify-between items-center">
          <span class="opacity-75">Team Created</span>
          <span class="font-semibold">{{
            team()!.createdAt | date : "short"
          }}</span>
        </div>
      </div>
    </div>

    <div class="card">
      <h3 class="font-semibold text-lg mb-4">Quick Actions</h3>
      <div class="space-y-3">
        <button
          class="btn btn-outline w-full justify-start"
          (click)="onEditTeam()"
        >
          <lucide-angular [img]="icons.Edit" [size]="16"></lucide-angular>
          Edit Team Details
        </button>
        <button
          class="btn btn-outline w-full justify-start"
          (click)="onShowAddPlayer()"
        >
          <lucide-angular [img]="icons.UserPlus" [size]="16"></lucide-angular>
          Add New Player
        </button>
      </div>
    </div>
  </div>
</div>
} @if (showAddPlayerModal()) {
<div
  class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"
>
  <div class="card rounded-lg p-6 w-full max-w-md">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-lg font-semibold">Add New Player</h3>
      <button
        class="text-gray-400 hover:text-gray-600"
        (click)="onCloseAddPlayerModal()"
      >
        <lucide-angular [img]="icons.X" [size]="20"></lucide-angular>
      </button>
    </div>

    <form [formGroup]="addPlayerForm" (ngSubmit)="onAddPlayer()">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >First Name</label
            >
            <input
              type="text"
              formControlName="firstName"
              class="input-field"
              placeholder="Enter first name"
              required
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Last Name</label
            >
            <input
              type="text"
              formControlName="lastName"
              class="input-field"
              placeholder="Enter last name"
              required
            />
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1"
            >Position</label
          >
          <input
            type="text"
            formControlName="position"
            class="input-field"
            placeholder="e.g., Forward, Midfielder, Defender"
          />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1"
            >Email</label
          >
          <input
            type="email"
            formControlName="email"
            class="input-field"
            placeholder="player@example.com"
          />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1"
            >Photo</label
          >
          <input
            type="file"
            accept="image/*"
            class="input-field"
            (change)="onFileSelect($event, 'add')"
          />
        </div>
      </div>

      <div class="flex gap-3 mt-6">
        <button
          type="button"
          class="btn btn-outline flex-1"
          (click)="onCloseAddPlayerModal()"
        >
          Cancel
        </button>
        <button
          type="submit"
          class="btn btn-primary flex-1"
          [disabled]="!addPlayerForm.valid"
        >
          <lucide-angular [img]="icons.Plus" [size]="16"></lucide-angular>
          Add Player
        </button>
      </div>
    </form>
  </div>
</div>
} @if (editingPlayer()) {
<div
  class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"
>
  <div class="card rounded-lg p-6 w-full max-w-md">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-lg font-semibold">Edit Player</h3>
      <button
        class="text-gray-400 hover:text-gray-600"
        (click)="onCloseEditPlayerModal()"
      >
        <lucide-angular [img]="icons.X" [size]="20"></lucide-angular>
      </button>
    </div>

    <form [formGroup]="editPlayerForm" (ngSubmit)="onUpdatePlayer()">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >First Name</label
            >
            <input
              type="text"
              formControlName="firstName"
              class="input-field"
              placeholder="Enter first name"
              required
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Last Name</label
            >
            <input
              type="text"
              formControlName="lastName"
              class="input-field"
              placeholder="Enter last name"
              required
            />
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1"
            >Position</label
          >
          <input
            type="text"
            formControlName="position"
            class="input-field"
            placeholder="e.g., Forward, Midfielder, Defender"
          />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1"
            >Email</label
          >
          <input
            type="email"
            formControlName="email"
            class="input-field"
            placeholder="player@example.com"
          />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1"
            >Photo</label
          >
          <input
            type="file"
            accept="image/*"
            class="input-field"
            (change)="onFileSelect($event, 'edit')"
          />
        </div>
      </div>

      <div class="flex gap-3 mt-6">
        <button
          type="button"
          class="btn btn-outline flex-1"
          (click)="onCloseEditPlayerModal()"
        >
          Cancel
        </button>
        <button
          type="submit"
          class="btn btn-primary flex-1"
          [disabled]="!editPlayerForm.valid"
        >
          <lucide-angular [img]="icons.Save" [size]="16"></lucide-angular>
          Update Player
        </button>
      </div>
    </form>
  </div>
</div>
}
