<div class="relative h-full flex flex-col">
  <div
    class="flex md:justify-between justify-center flex-col md:flex-row items-center flex-wrap mb-4"
  >
    <h1 class="text-lg md:text-2xl font-bold text-gray-900 dark:text-gray-100">
      Available Tournaments
    </h1>
    <div class="text-sm text-gray-600 dark:text-gray-400">
      {{ myTeams().length }} team{{ myTeams().length !== 1 ? "s" : "" }}
      available
    </div>
  </div>

  <app-tournament-search
    (clearFiltersSearch)="onClearSearch()"
    (searchChange)="onSearchChange($event)"
  />

  @if (isLoading()) {
  <div class="text-center py-12">
    <div
      class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mb-4"
    ></div>
    <p class="text-gray-600 dark:text-gray-400">Loading tournaments...</p>
  </div>
  } @if (!isLoading() && tournaments().length === 0) {
  <div class="text-center py-12">
    <div class="text-gray-400 dark:text-gray-600 mb-3">
      <lucide-angular
        [img]="icons.Trophy"
        [size]="64"
        class="mx-auto"
      ></lucide-angular>
    </div>
    <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2">
      No tournaments found
    </h3>
    @if (searchCriteria().searchTerm || searchCriteria().status) {
    <p class="text-gray-600 dark:text-gray-400 mb-4">
      No tournaments match your search criteria.
    </p>
    <button class="btn btn-secondary" (click)="onClearSearch()">
      Clear Filters
    </button>
    } @else {
    <p class="text-gray-600 dark:text-gray-400">
      There are currently no tournaments available to join.
    </p>
    }
  </div>
  } @if (!isLoading() && tournaments().length > 0) {
  <div class="flex items-center mb-4">
    @if (totalRecords() > 0) {
    <span class="text-sm text-gray-600 dark:text-gray-400">
      {{ totalRecords() }} Tournaments
    </span>
    }
  </div>

  <div class="flex-1">
    <div
      class="grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3"
    >
      @for (tournament of tournaments(); track tournament.id) {
      <app-tournament-card
        [tournament]="tournament"
        role="User"
        (join)="onTournamentJoin($event)"
        (view)="onTournamentView($event)"
        (leave)="onTournamentLeave($event)"
      ></app-tournament-card>
      }
    </div>
  </div>

  <div
    class="flex flex-col sm:flex-row justify-between flex-wrap items-center gap-4 pt-4 border-t mt-auto"
  >
    <div class="flex items-center gap-2 mx-auto">
      <label class="text-sm font-medium">Show:</label>
      <select
        class="input-field text-sm py-1 px-2 min-w-0"
        [value]="searchCriteria().pageSize"
        (change)="onPageSizeSelectChange($event)"
      >
        <option value="6">6 per page</option>
        <option value="12">12 per page</option>
        <option value="24">24 per page</option>
        <option value="48">48 per page</option>
      </select>
    </div>

    <div class="text-sm text-gray-600 dark:text-gray-400 mx-auto">
      Page {{ currentPage() }} of {{ totalPages() }} ({{ totalRecords() }}
      total)
    </div>

    @if (totalPages() > 1) {
    <div class="flex items-center gap-1 mx-auto">
      <button
        class="btn btn-secondary btn-sm"
        [disabled]="!hasPreviousPage()"
        (click)="onPageChange(1)"
        title="First page"
      >
        <lucide-angular [img]="icons.ChevronsLeft" size="16" />
      </button>
      <button
        class="btn btn-secondary btn-sm"
        [disabled]="!hasPreviousPage()"
        (click)="onPageChange(currentPage() - 1)"
        title="Previous page"
      >
        <lucide-angular [img]="icons.ChevronLeft" size="16" />
      </button>

      @for (pageNum of getPageNumbers(); track pageNum) {
      <button
        class="btn btn-sm"
        [class.btn-primary]="pageNum === currentPage()"
        [class.btn-secondary]="pageNum !== currentPage()"
        (click)="onPageChange(pageNum)"
      >
        {{ pageNum }}
      </button>
      }

      <button
        class="btn btn-secondary btn-sm"
        [disabled]="!hasNextPage()"
        (click)="onPageChange(currentPage() + 1)"
        title="Next page"
      >
        <lucide-angular [img]="icons.ChevronRight" size="16" />
      </button>
      <button
        class="btn btn-secondary btn-sm"
        [disabled]="!hasNextPage()"
        (click)="onPageChange(totalPages())"
        title="Last page"
      >
        <lucide-angular [img]="icons.ChevronsRight" size="16" />
      </button>
    </div>
    }

    <!-- <div class="flex items-center gap-2 mx-auto">
      <button
        class="btn btn-secondary btn-sm"
        [disabled]="!hasPreviousPage()"
        (click)="onPageChange(1)"
      >
        First
      </button>
      <button
        class="btn btn-secondary btn-sm"
        [disabled]="!hasPreviousPage()"
        (click)="onPageChange(currentPage() - 1)"
      >
        Previous
      </button>

      @for (pageNum of getPageNumbers(); track pageNum) {
      <button
        class="btn btn-sm"
        [class.btn-primary]="pageNum === currentPage()"
        [class.btn-secondary]="pageNum !== currentPage()"
        (click)="onPageChange(pageNum)"
      >
        {{ pageNum }}
      </button>
      }

      <button
        class="btn btn-secondary btn-sm"
        [disabled]="!hasNextPage()"
        (click)="onPageChange(currentPage() + 1)"
      >
        Next
      </button>
      <button
        class="btn btn-secondary btn-sm"
        [disabled]="!hasNextPage()"
        (click)="onPageChange(totalPages())"
      >
        Last
      </button>
    </div> -->
  </div>
  }
</div>

<app-team-selection-modal
  [isOpen]="showTeamSelectionModal()"
  [teams]="myTeams()"
  [tournament]="selectedTournament()"
  [isJoining]="isJoiningTournament()"
  (teamSelected)="onTeamSelected($event)"
  (modalClosed)="onTeamSelectionModalClosed()"
  (createTeamClicked)="onCreateTeamFromModal()"
></app-team-selection-modal>
