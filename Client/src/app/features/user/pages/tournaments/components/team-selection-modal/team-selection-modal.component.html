<div
  *ngIf="isOpen"
  class="fixed inset-0 flex items-center justify-center z-50 p-4"
  (click)="onBackdropClick($event)"
>
  <div
    class="card rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden"
  >
    <div class="flex items-center justify-between p-6 border-b">
      <div>
        <h2 class="text-xl font-semibold">Select Team</h2>
        <p *ngIf="tournament" class="text-sm mt-1">
          Choose a team to register for {{ tournament.name }}
        </p>
      </div>
      <button (click)="closeModal()" class="p-2 cursor-pointer rounded-lg">
        <lucide-angular [img]="icons.X" [size]="20"></lucide-angular>
      </button>
    </div>

    <div class="p-6">
      <div *ngIf="teams.length === 0" class="text-center py-12">
        <lucide-angular
          [img]="icons.Users"
          [size]="64"
          class="mx-auto mb-4"
        ></lucide-angular>
        <h3 class="text-lg font-semibold mb-2">No Teams Found</h3>
        <p class="mb-6">
          You need to create a team before you can register for tournaments.
        </p>
        <button
          (click)="onCreateTeam()"
          class="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg"
        >
          <lucide-angular [img]="icons.CirclePlus" [size]="16"></lucide-angular>
          Create Team
        </button>
      </div>

      <div *ngIf="teams.length > 0">
        <div class="space-y-3 max-h-96 overflow-y-auto">
          <div
            *ngFor="let team of teams; trackBy: trackByTeamId"
            class="p-4 border rounded-lg cursor-pointer"
            (click)="selectTeam(team)"
          >
            <div class="flex items-center justify-between">
              <div class="flex items-center space-x-3">
                <div *ngIf="team.logoUrl; else defaultLogo">
                  <img
                    [src]="team.logoUrl"
                    [alt]="team.name"
                    class="w-12 h-12 rounded-lg object-cover"
                  />
                </div>
                <ng-template #defaultLogo>
                  <div
                    class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center text-white font-bold"
                  >
                    {{ team.name.charAt(0).toUpperCase() }}
                  </div>
                </ng-template>
                <div>
                  <h4 class="font-semibold">
                    {{ team.name }}
                  </h4>
                  <p *ngIf="team.shortName" class="text-sm">
                    {{ team.shortName }}
                  </p>
                </div>
              </div>
              <div
                class="w-5 h-5 rounded-full border-2 flex items-center justify-center"
                [class.border-blue-500]="selectedTeam() === team"
                [class.bg-blue-500]="selectedTeam() === team"
                [class.border-gray-300]="selectedTeam() !== team"
              >
                <lucide-angular
                  *ngIf="selectedTeam() === team"
                  [img]="icons.Check"
                  [size]="12"
                  class="text-white"
                ></lucide-angular>
              </div>
            </div>
          </div>
        </div>

        <div class="mt-4 pt-4 border-t">
          <button
            (click)="onCreateTeam()"
            class="w-full p-3 border-2 border-dashed border-gray-300 cursor-pointer rounded-lg"
          >
            <div class="flex items-center justify-center gap-2">
              <lucide-angular
                [img]="icons.CirclePlus"
                [size]="16"
              ></lucide-angular>
              <span>Create New Team</span>
            </div>
          </button>
        </div>
      </div>
    </div>

    <div
      *ngIf="teams.length > 0"
      class="flex items-center justify-end gap-3 p-6 border-t"
    >
      <button
        (click)="closeModal()"
        class="px-4 py-2 btn btn-secondary"
        [disabled]="isJoining"
      >
        Cancel
      </button>
      <button
        (click)="confirmSelection()"
        [disabled]="!selectedTeam() || isJoining"
        class="px-6 py-2 btn btn-primary"
      >
        <span>{{ isJoining ? "Registering..." : "Register Team" }}</span>
      </button>
    </div>
  </div>
</div>
